{
  "hash": "79366fb899a04c4ff3c8bbb4a8df71a6",
  "result": {
    "markdown": "---\ntitle: 30 Days Map Challange - Day 1 - Points\nauthor: Enrico Spinielli\ndate: '2022-11-01'\nlicense: CC BY-SA\ndraft: true\n---\n\nI surely won't be able to participate to the 2022's `#30DaysMapChallenge` but while porting\nmy website to Quarto I got to re-read my [2012's blog entry](https://enrico.spinielli.net/posts/2012-05-19-automatically-extracting-bomb-drops/)\nand thought that dataset could be a good one to use for at list the first day of the challenge.\n\n\n{{< tweet espinielli 1587475038470606848 >}}\n\n\n\nThis post will describe what I did using R and ggplot2, but I will also add a rendering of it\nusing Observable.\n\n\n## Data\n\nI knew that since my 2012 post the Sight Bombing project in the meantime grew a\n[website](http://bombsight.org/) and even an [Android app](http://bombsight.org/androidapp/).\nSo I tried to find the relevant data serving the front-ends; I even contacted via email\nDr Catherine Jones (the project director at the time) but then I realized there is a\n[geo server][geoserver] where to get the data from.\n\nThere are 3 files for the Blitz bombing:\n\n* First 24 hours of the Blitz (7th September 1940) [sit-prod_day_bomb.json][day] (536KB)\n* Week of 7th to 14th October 1940 [sit-prod_week_bomb.json][week] (1.0B)\n* Between 1940-10-07 and 1941-06-06 [sit-prod_agg_bomb.json][all] (17MB)\n\n[day]: <https://github.com/espinielli/blog/tree/master/posts/2022-11-01-30daysmapchallange-day1/sit-prod_day_bomb.json>\n[week]: <https://github.com/espinielli/blog/tree/master/posts/2022-11-01-30daysmapchallange-day1/sit-prod_week_bomb.json>\n[all]: <https://github.com/espinielli/blog/tree/master/posts/2022-11-01-30daysmapchallange-day1/sit-prod_agg_bomb.json>\n\n\n\n## ggplot2 version\n\n![tweeted plot](tweet-plot.png)\n\n\n::: {.cell hash='index_cache/html/ggplot2-version_a73d2639273efd924bbba5c69be67f7d'}\n\n```{.r .cell-code}\nlibrary(sf)\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(osmdata)\n\nday_bomb <- read_sf(\"sit-prod_day_bomb.json\")\n\n# get relevant features from OpenStreetMap\ntown <- 'Greater London'\nlocation <- town %>% opq()\n\nlondon_bbox <- getbb(\"greater London\", format_out = \"polygon\")\nlondon_sf <- getbb(\"greater London\", format_out = \"sf_polygon\")\n\n# different types of streets\nmain_st <- tribble(\n\t~type,\n\t\"motorway\",\n\t\"trunk\",\n\t\"primary\",\n\t\"motorway_junction\",\n\t\"trunk_link\",\n\t\"primary_link\",\n\t\"motorway_link\")\nst <- data.frame(type = available_tags('highway'))\nst <- subset(st, !type %in% main_st$type)\npath <- data.frame(type = c(\"footway\",\"path\",\"steps\",\"cycleway\"))\nst <- subset(st, !type %in% main_st$type)\npath <- tribble(\n\t~type,\n\t\"footway\",\n\t\"path\",\n\t\"steps\",\n\t\"cycleway\")\nst <- subset(st, !type %in% path$type)\nst <- as.character(st$type)\nmain_st <- as.character(main_st$type)\npath <- as.character(path$type)\n\n#query OSM\nmain_streets <- location %>%\n\tadd_osm_feature(key = \"highway\",\n\t\t\t\t\t\t\t\t\tvalue = main_st) %>%\n\tosmdata_sf()\n\nstreets <- location %>%\n\tadd_osm_feature(key = \"highway\",\n\t\t\t\t\t\t\t\t\tvalue = st) %>%\n\tosmdata_sf()\n\nwater <- location %>%\n\tadd_osm_feature(key = \"water\",\n\t\t\t\t\t\t\t\t\tvalue = c(\"river\")) %>%\n\tosmdata_sf()\n\nrail <- location %>%\n\tadd_osm_feature(key = \"railway\",\n\t\t\t\t\t\t\t\t\tvalue = c(\"rail\")) %>%\n\tosmdata_sf()\n\n#plot map\nggplot() +\n\tgeom_sf(data = london_sf, size = 0.1, fill = 'antiquewhite1') +\n\tgeom_sf(data = main_streets$osm_lines %>% st_intersection(london_sf),\n\t\t\t\t\tcolor = 'grey',\n\t\t\t\t\tsize = 0.15) +\n\tgeom_sf(data = water$osm_polygons %>% st_intersection(london_sf),\n\t\t\t\t\tfill = rgb(178, 210, 221, maxColorValue = 255),\n\t\t\t\t\tsize = 0) +\n\tgeom_sf(data = water$osm_multipolygons %>% st_intersection(london_sf),\n\t\t\t\t\tfill = rgb(178, 210, 221, maxColorValue = 255),\n\t\t\t\t\tsize = 0) +\n\tgeom_sf(data = day_bomb%>% st_intersection(london_sf),\n\t\t\t\t\tcolor = 'red',\n\t\t\t\t\tfill = 'red',\n\t\t\t\t\tsize = 1,\n\t\t\t\t\talpha = 0.4) +\n\ttheme_void() +\n\tlabs(\n\t\ttitle = \"First night of the Blitz, London, UK\",\n\t\tsubtitle = \"7th-8th Oct 1940\",\n\t\tcaption = \"data: Bomb Sight (www.bombsight.org ver 1.0, 2022-11-01) & OpenStreetMap\"\n\t)\n```\n:::\n\n\n\n## Observable version\n\n\n\n[geoserver]: <http://geoserver.bombsight.org/geoserver/web/wicket/bookmarkable/org.geoserver.web.demo.MapPreviewPage?5>",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}